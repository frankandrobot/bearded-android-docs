<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Bearded-android-docs : Android quick docs" />

    <link rel="stylesheet" type="text/css" media="screen" href="http://frankandrobot.github.io/bearded-android-docs/stylesheets/stylesheet.css">

    <title>Singleton</title>
    <meta name='Generator' content='Zim 0.60'>
    
    <script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/2.3-latest/MathJax.js?config=AM_HTMLorMML.js">
</script>

  </head>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/frankandrobot/bearded-android-docs">View on GitHub</a>

          <h1 id="project_title">Bearded-android-docs</h1>
          <h2 id="project_tagline">Singleton</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/frankandrobot/bearded-android-docs/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/frankandrobot/bearded-android-docs/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

<!-- Wiki content -->

<p>
Created Monday 09 September 2013<br>
</p>

<p>
When instantiating a singleton, make sure that the instantiator actually instantiates <em>one</em> instance of the object<br>
i.e., take into account <a href="./ConcurrencyIssues.html" title="ConcurrencyIssues" class="page">ConcurrencyIssues</a><br>
</p>

<p>
  <code>@Good</code><br>
</p>
<pre>
class A
{
       static private A instance = new A(); //thread-safe
       static public A getInstance{ return A; }
}
</pre>


<p>
Lazy instantiation:<br>
</p>

<p>
  <code>@Good (lazy instantiation)</code><br>
</p>
<pre>
class A
{
      private static class Holder 
      {
            static private A instance = new A();
      }
      static public A getInstance() { return Holder.instance; } //thread-safe but doesn't get instantiated until called
}
</pre>


<h2>Bad Example (Old school DoubleCheckedLocking)</h2>
<p>
Back in the days when it was expensive to enter a synchronized block, people would instantiate a singleton this way:<br>
</p>

<pre>
public class PieChucker 
{
    private static PieChucker instance;
    public static PieChucker getInstance() 
    {
        if(instance == null) { 
            synchronized(PieChucker.class) {
                if(instance == null) {
                     instance = new PieChucker();
                }
            }
        }
        return instance;
    }
</pre>
<p>
  }<br>
<br>
The problem with this technique has to do with JavaMemory:CacheCoherence. Even though Objects are stored in the heap, methods often create cached copies of variables and then sync the results with the heap. Suppose this happens:<br>
<ul>
<li>Thread_1 is the first to call getInstance(). It proceeds to create a new PieChucker. While it is doing this, Thread_2....</li>
<li>Thread_2 calls getInstance(). It sees null instance so it passes the first check. It stops at the synchronized barrier. Meanwhile...</li>
<li>Thread_1 finishes creating the PieChucker. It leaves the synchronized block. HOWEVER,....</li>
<li>the PieChucker was created on the heap but it still hasn't been initialized completely. As a result...</li>
<li>Thread_2 enters the synchronized block. It thinks it has a (complete) <a href="./PieChucker.html" title="PieChucker" class="page">PieChucker</a> and returns an incomplete object.</li>
</ul>
<br>
Sources:<br>
<ul>
<li><a href="http://tech.puredanger.com/2007/06/15/double-checked-locking/" title="http://tech.puredanger.com/2007/06/15/double-checked-locking/" class="http">http://tech.puredanger.com/2007/06/15/double-checked-locking/</a></li>
<li><a href="http://javamex.com/tutorials/synchronization_concurrency_synchronized2.shtml" title="http://javamex.com/tutorials/synchronization_concurrency_synchronized2.shtml" class="http">http://javamex.com/tutorials/synchronization_concurrency_synchronized2.shtml</a></li>
</ul>
<br>
</p>
<h2>Warnings</h2>
<p>
<ol type="1" start="1">
<li>They are generally used as a global instance, why is that so bad? Because you hide the dependencies of your application in your code, instead of exposing them through the interfaces. Making something global to avoid passing it around is a code smell.</li>
<li>They violate the Single Responsibility Principle: by virtue of the fact that they control their own creation and lifecycle.</li>
<li>They inherently cause code to be tightly coupled. This makes faking them out under test rather difficult in many cases.</li>
<li>They carry state around for the lifetime of the app. Another hit to testing since you can end up with a situation where tests need to be ordered which is a big no no for unit tests. Why? Because each unit test should be independent from the other.</li>
<li>Singletons are nothing more than global state. Global state makes it so your objects can secretly get hold of things which are not declared in their APIs, and, as a result, Singletons make your APIs into pathological liars.</li>
</ol>
<br>
</p>
<h1>Links</h1>
<p>
<ul>
<li><a href="http://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons" title="http://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons" class="http">http://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons</a></li>
<li><a href="http://jorudolph.wordpress.com/2009/11/22/singleton-considerations/" title="http://jorudolph.wordpress.com/2009/11/22/singleton-considerations/" class="http">http://jorudolph.wordpress.com/2009/11/22/singleton-considerations/</a></li>
<li><a href="http://misko.hevery.com/2008/08/17/singletons-are-pathological-liars/" title="http://misko.hevery.com/2008/08/17/singletons-are-pathological-liars/" class="http">http://misko.hevery.com/2008/08/17/singletons-are-pathological-liars/</a></li>
<li>See also the <a href="http://gen5.info/q/2008/07/25/the-multiton-design-pattern/" title="http://gen5.info/q/2008/07/25/the-multiton-design-pattern/" class="http">http://gen5.info/q/2008/07/25/the-multiton-design-pattern/</a></li>
</ul>
</p>


<!-- End wiki content -->

<hr />

<!-- Attachments and Backlinks -->

	<i>No backlinks to this page.</i>



<!-- End Attachments and Backlinks -->

    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'beardedandroid'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Bearded-android-docs maintained by <a href="https://github.com/frankandrobot">frankandrobot</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
        <p><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>

      </footer>
    </div>

    

  </body>
</html>
